function mgKey(){}function mgMouse(){}function mgCore(t,e,i,s,n,o){this.canvas_=document.getElementById(t),this.canvas_.addEventListener("mousedown",mgMouse.onMouseDown,!0),this.canvas_.addEventListener("mouseup",mgMouse.onMouseUp,!0),this.canvas_.addEventListener("mousemove",mgMouse.onMouseMove,!0),this.canvas_.addEventListener("mouseout",mgMouse.onMouseOut,!0),this.canvas_.addEventListener("touchstart",mgMouse.onMouseDown,!0),this.canvas_.addEventListener("touchend",mgMouse.onMouseUp,!0),this.canvas_.addEventListener("touchmove",mgMouse.onMouseMove,!0),this.canvas_.addEventListener("touchcancel",mgMouse.onMouseUp,!0),this.canvas_.addEventListener("click",mgMouse.onMouseClick,!0),this.context_=this.canvas_.getContext("2d"),this.fontSetting_="13px 'Arial'",this.setUrl("http://mygamestudio.x.fc2.com/ "),this.context_.font=this.fontSetting_,this.urlWidth_=this.context_.measureText(this.url_).width,this.urlOnMouse_=!1,this.frameRate=e,this.frameRate<=0&&(this.frameRate=30),this.execInit_=!1,this.initFunc_=i,this.execFunc_=s,this.drawFunc_=n,this.baseObject_=o,this.baseObject_.parent_=this}function mgInitialize(t,e,i,s,n,o){document.addEventListener("keydown",mgKey.onKeyDown,!0),document.addEventListener("keyup",mgKey.onKeyUp,!0),setInterval(mgExecute,Math.floor(1e3/e)),gCore[t]=new mgCore(t,e,i,s,n,o)}function mgExecute(){mgKey.update(),mgMouse.update();var t=0;for(var e in gCore)void 0!==e&&t++;for(var e in gCore){var i=mgMouse.getCurrentTarget()===e||2>t,s=gCore[e].callback("drawonce");(i||!s)&&(gCore[e].update(),gCore[e].draw())}}function mgReset(t){void 0!=gCore[t]&&gCore[t].reset()}function mgCallback(t,e){return void 0!=gCore[t]?gCore[t].callback(e):void 0}function mgDebug(t){mgCallback(t,"debug")}function Point(t,e){this.set(t,e)}function Spline(){this.a_=null,this.b_=null,this.c_=null,this.d_=null,this.size_=0}function CubicCurve(){this.vertices_=null,this.splineX_=null,this.splineY_=null}function mgImage(){this.clear(),this.x_=0,this.y_=0}var KEY={UP:38,DOWN:40,LEFT:37,RIGHT:39,SPACE:32,Z:90,X:88};mgKey.keyTable_=[KEY.UP,KEY.DOWN,KEY.LEFT,KEY.RIGHT,KEY.SPACE,KEY.Z,KEY.X],mgKey.input_=[!1,!1,!1,!1,!1,!1,!1],mgKey.inputOld_=[!1,!1,!1,!1,!1,!1,!1],mgKey.repeatTimer_=[0,0,0,0,0,0,0],mgKey.getKeyIndex=function(t){for(var e=0;e<this.keyTable_.length;e++)if(t==this.keyTable_[e])return e;return-1},mgKey.setKey=function(t,e){var i=this.getKeyIndex(t);i>=0&&(this.input_[i]=e)},mgKey.on=function(t){var e=this.getKeyIndex(t);return e>=0?this.input_[e]:!1},mgKey.off=function(t){var e=this.getKeyIndex(t);return e>=0?!this.input_[e]:!0},mgKey.press=function(t){var e=this.getKeyIndex(t);return e>=0?this.input_[e]&&!this.inputOld_[e]:!1},mgKey.release=function(t){var e=this.getKeyIndex(t);return e>=0?!this.input_[e]&&this.inputOld_[e]:!1},mgKey.repeat=function(t){var e=this.getKeyIndex(t);return e>=0?this.on(t)&&(0==this.repeatTimer_[e]||this.repeatTimer_[e]>15&&this.repeatTimer_[e]%5==0):void 0},mgKey.update=function(){for(var t=0;t<this.input_.length;t++)this.inputOld_[t]&&this.input_[t]?this.repeatTimer_[t]++:this.repeatTimer_[t]=0,this.inputOld_[t]=this.input_[t]},mgKey.onKeyDown=function(t){mgKey.setKey(t.keyCode,!0),mgKey.keyCode_=t.keyCode},mgKey.onKeyUp=function(t){mgKey.setKey(t.keyCode,!1)},mgMouse.x=-1,mgMouse.y=-1,mgMouse.xs=[-1,-1,-1,-1,-1],mgMouse.ys=[-1,-1,-1,-1,-1],mgMouse.input_=[!1,!1,!1,!1,!1],mgMouse.inputOld_=[!1,!1,!1,!1,!1],mgMouse.dontMoveCount_=[0,0,0,0,0],mgMouse.repeatTimer_=[0,0,0,0,0],mgMouse.in_=!1,mgMouse.target_=null,mgMouse.clientX=-1,mgMouse.clientY=-1,mgMouse.clientXs=[-1,-1,-1,-1,-1],mgMouse.clientYs=[-1,-1,-1,-1,-1],mgMouse.numTouches=0,mgMouse.isPreventDefault=!1,mgMouse.updateNumTouches=function(t){"undefined"==typeof t.touches?this.numTouches=1:this.numTouches=t.touches.length},mgMouse.setPosition=function(t){var e=null!=navigator.userAgent.match(/iPad/i),i=null!=navigator.userAgent.match(/iPhone/i),s=t.target.getBoundingClientRect();if(e||i){this.x=t.touches[0].clientX-s.left,this.y=t.touches[0].clientY-s.top,this.clientX=t.touches[0].clientX,this.clientY=t.touches[0].clientY;for(var n=0;n<t.touches.length;n++)this.xs[n]=t.touches[n].clientX-s.left,this.ys[n]=t.touches[n].clientY-s.top,this.clientXs=t.touches[n].clientX,this.clientYs=t.touches[n].clientY,this.dontMoveCount_[n]=0}else this.x=t.clientX-s.left,this.y=t.clientY-s.top,this.numTouches=1,this.xs[0]=t.clientX-s.left,this.ys[0]=t.clientY-s.top,this.dontMoveCount_[0]=0},mgMouse.press=function(t){if("undefined"==typeof t&&(t=0),this.in_){if(t>=0)return!this.inputOld_[t]&&this.input_[t];for(var e=0;e<this.numTouches;e++)if(this.press(e))return!0}return!1},mgMouse.release=function(t){if("undefined"==typeof t&&(t=0),this.in_){if(t>=0)return this.inputOld_[t]&&!this.input_[t];for(var e=0;e<this.numTouches;e++)if(this.release(e))return!0}return!1},mgMouse.on=function(t){if("undefined"==typeof t&&(t=0),this.in_){if(t>=0)return this.input_[t];for(var e=0;e<this.numTouches;e++)if(this.on(e))return!0}return!1},mgMouse.off=function(t){if("undefined"==typeof t&&(t=0),this.in_){if(t>=0)return!this.input_[t];for(var e=0;e<this.numTouches;e++)if(this.off(e))return!0}return!0},mgMouse.repeat=function(t){if("undefined"==typeof t&&(t=0),this.in_){if(t>=0)return this.on(t)&&(0==this.repeatTimer_[t]||this.repeatTimer_[t]>15&&this.repeatTimer_[t]%5==0);for(var e=0;e<this.numTouches;e++)if(this.repeat(e))return!0}return!1},mgMouse.getDontMoveCount=function(t){return"undefined"==typeof t&&(t=0),this.dontMoveCount_[t]},mgMouse.update=function(){for(var t=0;t<this.input_.length;t++)this.inputOld_[t]&&this.input_[t]?this.repeatTimer_[t]++:this.repeatTimer_[t]=0;for(var t=0;t<this.input_.length;t++)this.inputOld_[t]=this.input_[t],this.dontMoveCount_[t]++},mgMouse.onMouseDown=function(t){mgMouse.updateNumTouches(t);for(var e=0;e<mgMouse.input_.length;e++)e<mgMouse.numTouches?mgMouse.input_[e]=!0:mgMouse.input_[e]=!1;mgMouse.in_=!0,mgMouse.target_=t.currentTarget.id,mgMouse.setPosition(t)},mgMouse.onMouseUp=function(t){mgMouse.updateNumTouches(t);for(var e=0;e<mgMouse.input_.length;e++)e>=mgMouse.numTouches-1&&(mgMouse.input_[e]=!1);mgMouse.in_=!0,mgMouse.target_=t.currentTarget.id,mgMouse.setPosition(t)},mgMouse.onMouseMove=function(t){mgMouse.updateNumTouches(t),mgMouse.isPreventDefault&&mgMouse.on()&&t.preventDefault(),mgMouse.in_=!0,mgMouse.target_=t.currentTarget.id,mgMouse.setPosition(t)},mgMouse.onMouseOut=function(t){mgMouse.onMouseUp(t),mgMouse.in_=!1,mgMouse.target_=null},mgMouse.onMouseClick=function(t){for(var e in gCore)void 0!==e&&gCore[e].urlOnMouse_&&window.open("http://mygamestudio.x.fc2.com/","_blank")},mgMouse.getCurrentTarget=function(){return mgMouse.target_},mgCore.prototype.update=function(){this.execInit_?void 0==this.baseObject_?this.execFunc_():this.baseObject_.Execute():(void 0==this.baseObject_?this.initFunc_(this.canvas_.width,this.canvas_.height,this.frameRate):this.baseObject_.Initialize(this,this.canvas_.width,this.canvas_.height,this.frameRate),this.execInit_=!0),mgMouse.x>=this.canvas_.width-this.urlWidth_&&mgMouse.y>=this.canvas_.height-5-14?this.urlOnMouse_=!0:this.urlOnMouse_=!1},mgCore.prototype.draw=function(){this.context_.fillStyle="#FFFFFF",this.context_.fillRect(0,0,this.canvas_.width,this.canvas_.height),this.context_.strokeStyle="#000000",this.context_.strokeRect(0,0,this.canvas_.width,this.canvas_.height),void 0==this.baseObject_?this.drawFunc_(this.context_):this.baseObject_.Draw(this.context_),this.context_.font=this.fontSetting_,this.context_.fillStyle="#000000",this.context_.fillText(this.url_,this.canvas_.width-this.urlWidth_+1,this.canvas_.height-5+1),this.urlOnMouse_?this.context_.fillStyle="#FFAA44":this.context_.fillStyle="#FFFFFF",this.context_.fillText(this.url_,this.canvas_.width-this.urlWidth_,this.canvas_.height-5)},mgCore.prototype.reset=function(){this.callback("reset")},mgCore.prototype.callback=function(t){return void 0!=this.baseObject_?this.baseObject_.Callback(t):null},mgCore.prototype.setUrl=function(t){this.url_=t,this.urlWidth_=this.context_.measureText(this.url_).width},mgCore.prototype.getUrl=function(){return this.url_},mgCore.prototype.roundRect=function(t,e,i,s,n,o,r,h,u,a){var c=o;o=Math.min(Math.min(o,.5*s),.5*n),void 0!=u&&c>o&&(e+=c-o,s-=2*(c-o)),void 0!=a&&c>o&&(i+=c-o,n-=2*(c-o)),t.beginPath(),t.moveTo(e+o,i),t.lineTo(e+s-o,i),t.quadraticCurveTo(e+s,i,e+s,i+o),t.lineTo(e+s,i+n-o),t.quadraticCurveTo(e+s,i+n,e+s-o,i+n),t.lineTo(e+o,i+n),t.quadraticCurveTo(e,i+n,e,i+n-o),t.lineTo(e,i+o),t.quadraticCurveTo(e,i,e+o,i),t.closePath(),r&&t.fill(),h&&t.stroke()};var gCore=new Object;Point.prototype.set=function(t,e){this.x=t,this.y=e},Point.prototype.getLengthSq=function(){return this.x*this.x+this.y*this.y},Point.prototype.getLength=function(){return Math.sqrt(this.getLengthSq())},Point.prototype.normalize=function(){var t=this.getLength();return t>0&&this.scale(1/t),this},Point.prototype.getNormalize=function(){var t=this.clone();return t.normalize(),t},Point.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Point.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Point.prototype.scale=function(t){this.x*=t,this.y*=t},Point.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Point.prototype.clone=function(){return new Point(this.x,this.y)},Spline.prototype.create=function(t){this.a_=new Array(t.length+1),this.b_=new Array(t.length+1),this.c_=new Array(t.length+1),this.d_=new Array(t.length+1);var e=new Array(t.length+1);this.size_=t.length-1;for(var i=0;i<=this.size_;i++)this.a_[i]=t[i];this.c_[0]=this.c_[this.size_]=0;for(var i=1;i<this.size_;i++)this.c_[i]=3*(this.a_[i-1]-2*this.a_[i]+this.a_[i+1]);e[0]=0;for(var i=1;i<this.size_;i++){var s=4-e[i-1];this.c_[i]=(this.c_[i]-this.c_[i-1])/s,e[i]=1/s}for(var i=this.size_-1;i>0;i--)this.c_[i]=this.c_[i]-this.c_[i+1]*e[i];this.b_[this.size_]=this.d_[this.size_]=0;for(var i=0;i<this.size_;i++)this.d_[i]=(this.c_[i+1]-this.c_[i])/3,this.b_[i]=this.a_[i+1]-this.a_[i]-this.c_[i]-this.d_[i]},Spline.prototype.calc=function(t){var e=Math.floor(t);0>e?e=0:e>this.size_&&(t=this.size_,e=this.size_);var i=t-e;return this.a_[e]+(this.b_[e]+(this.c_[e]+this.d_[e]*i)*i)*i},CubicCurve.prototype.create=function(t){this.vertices_=t;for(var e=new Array(this.vertices_.length),i=new Array(this.vertices_.length),s=0;s<this.vertices_.length;s++)e[s]=this.vertices_[s].x,i[s]=this.vertices_[s].y;this.splineX_=new Spline,this.splineX_.create(e),this.splineY_=new Spline,this.splineY_.create(i)},CubicCurve.prototype.calcX=function(t){return this.splineX_.calc(t)},CubicCurve.prototype.calcY=function(t){return this.splineY_.calc(t)},CubicCurve.prototype.draw=function(t,e,i){var s=this.calcX(0),n=this.calcY(0);t.moveTo(s,n),this.lineTo(t,e,i)},CubicCurve.prototype.lineTo=function(t,e,i){var s=.1,n=0,o=0;void 0!=e&&(n=e),void 0!=i&&(o=i);var r=this.calcX(0),h=this.calcY(0);t.lineTo(r,h);for(var u=s;u<this.vertices_.length;u+=s)r=this.calcX(u),h=this.calcY(u),t.lineTo(r+n,h+o)},mgImage.prototype.request=function(t){this.url_=t,this.img_.src=this.url_+"?"+(new Date).getTime(),this.loading_=!0,this.img_.parent_=this,this.img_.onload=function(){this.parent_.onLoad()},this.img_.onerror=function(){this.parent_.onError()}},mgImage.prototype.setup=function(t){this.url_=t.src,this.img_=t,this.onLoad()},mgImage.prototype.release=function(){this.clear()},mgImage.prototype.clear=function(){this.img_=new Image,this.url_="",this.loading_=!1,this.error_=!1},mgImage.prototype.isLoading=function(){return this.loading_},mgImage.prototype.isError=function(){return this.error_},mgImage.prototype.onLoad=function(){this.loading_=!1},mgImage.prototype.onError=function(){this.error_=!0,this.loading_=!1},mgImage.prototype.draw=function(t){this.isLoading()||this.isError()||t.drawImage(this.img_,this.x_,this.y_)},mgImage.prototype.drawOffset=function(t,e,i){this.isLoading()||this.isError()||t.drawImage(this.img_,this.x_+e,this.y_+i)},mgImage.prototype.drawOffsetScale=function(t,e,i,s,n){this.isLoading()||this.isError()||t.drawImage(this.img_,this.x_+e,this.y_+i,this.img_.width*s,this.img_.height*n)},mgImage.prototype.setPosition=function(t,e){this.x_=t,this.y_=e};